--- twistedcaldav/mail.py	2011-02-18 19:44:51.000000000 +0100
+++ twistedcaldav/mail.py	2011-02-18 17:35:18.000000000 +0100
@@ -743,17 +742,15 @@
                 contextFactory = None
 
             deferred = defer.Deferred()
-            msg.replace_header("From", fromAddr)
-            msg.replace_header("To", toAddr)
+            del msg["From"]
+            msg["From"] = fromAddr
             del msg["Reply-To"]
-
-            f4 = open("/tmp/caldav/msg-direct-before-sending","w+")
-            f4.write(msg.as_string().replace("\r\n","\n"))
-            f4.close()
-
+            msg["Reply-To"] = fromAddr
+            del msg["To"]
+            msg["To"] = toAddr
             factory = ESMTPSenderFactory(
                 settings["Username"], settings["Password"],
-                fromAddr, toAddr, StringIO(msg.as_string().replace("\r\n","\n")), deferred,
+                fromAddr, toAddr, StringIO(str(msg)), deferred,
                 contextFactory=contextFactory,
                 requireAuthentication=False,
                 requireTransportSecurity=settings["UseSSL"],
@@ -798,20 +795,9 @@
 
 
     def inbound(self, message, fn=injectMessage):
-        f = open('/tmp/caldav/inbound-message', 'w+')
-        f.write(message)
-        f.close()
-
-        msg = email.message_from_string(message)
-        f2 = open('/tmp/caldav/inbound-msg', 'w+')
-        f2.write(str(msg))
-        f2.close()
-
-        f3 = open('/tmp/caldav/inbound-msg-as-string', 'w+')
-        f3.write(msg.as_string())
-        f3.close()
-
         try:
+            msg = email.message_from_string(message)
+
             isDSN, action, calBody = self.checkDSN(msg)
             if isDSN:
                 if action == 'failed' and calBody:
